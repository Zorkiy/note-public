#!/usr/bin/env bash

# ==============================================================================
#
#          FILE: rename_notes.sh
#
#         USAGE: ./rename_notes.sh
#
#   DESCRIPTION: –ü–µ—Ä–µ–π–º–µ–Ω–æ–≤—É—î —Ñ–∞–π–ª–∏ –Ω–æ—Ç–∞—Ç–æ–∫ .md —É –ø–æ—Ç–æ—á–Ω—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –∑—ñ
#                —Å—Ç–∞—Ä–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É (–î–î_–ú–ú_–†–†–†–†_–ì–ì_–•–•_–°–°.md) —É –Ω–æ–≤–∏–π,
#                —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç (–†–†–†–†-–ú–ú-–î–î_–ì–ì-–•–•-–°–°.md).
#                –°–∫—Ä–∏–ø—Ç —ñ–≥–Ω–æ—Ä—É—î —Ñ–∞–π–ª–∏, —è–∫—ñ –≤–∂–µ –º–∞—é—Ç—å –Ω–æ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç.
#
#       OPTIONS: ---
#  REQUIREMENTS: Bash v4+ (–¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–∏—Ö –≤–∏—Ä–∞–∑—ñ–≤)
#          BUGS: ---
#         NOTES: –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –∑ –æ–±–µ—Ä–µ–∂–Ω—ñ—Å—Ç—é. –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∑—Ä–æ–±–∏—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω—É
#                –∫–æ–ø—ñ—é –ø–µ—Ä–µ–¥ –º–∞—Å–æ–≤–∏–º –ø–µ—Ä–µ–π–º–µ–Ω—É–≤–∞–Ω–Ω—è–º.
#        AUTHOR: Your Name <your.email@example.com>
#  ORGANIZATION:
#       CREATED: 2025-09-02
#      REVISION: 1.0
#
# ==============================================================================

set -euo pipefail

# –õ—ñ—á–∏–ª—å–Ω–∏–∫ –¥–ª—è –ø—ñ–¥—Å—É–º–∫–æ–≤–æ—ó —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
renamed_count=0

echo "üîç –ü–æ—à—É–∫ —Ñ–∞–π–ª—ñ–≤ –¥–ª—è –ø–µ—Ä–µ–π–º–µ–Ω—É–≤–∞–Ω–Ω—è..."

# –ü–µ—Ä–µ–±–∏—Ä–∞—î–º–æ –≤—Å—ñ —Ñ–∞–π–ª–∏ –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º .md —É –ø–æ—Ç–æ—á–Ω—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó
for old_name in *.md; do
    # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —ñ–º'—è —Ñ–∞–π–ª—É –°–¢–ê–†–û–ú–£ —Ñ–æ—Ä–º–∞—Ç—É:
    # –ù–∞–ø—Ä–∏–∫–ª–∞–¥: 01_09_2025_20_55_27.md
    # –†–µ–≥—É–ª—è—Ä–Ω–∏–π –≤–∏—Ä–∞–∑ –≤–∏–¥—ñ–ª—è—î –≥—Ä—É–ø–∏: (–î–î)_(–ú–ú)_(–†–†–†–†)_(–ì–ì)_(–•–•)_(–°–°)
    if [[ "$old_name" =~ ^([0-9]{2})_([0-9]{2})_([0-9]{4})_([0-9]{2})_([0-9]{2})_([0-9]{2})\.md$ ]]; then

        # –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑–±—ñ–≥—É —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –≤–∏—Ä–∞–∑—É –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –º–∞—Å–∏–≤—ñ BASH_REMATCH
        # BASH_REMATCH[0] - –≤–µ—Å—å –∑–±—ñ–≥
        # BASH_REMATCH[1] - –ø–µ—Ä—à–∞ –≥—Ä—É–ø–∞ (–î–î)
        # BASH_REMATCH[2] - –¥—Ä—É–≥–∞ –≥—Ä—É–ø–∞ (–ú–ú) —ñ —Ç–∞–∫ –¥–∞–ª—ñ.
        dd="${BASH_REMATCH[1]}"
        mm="${BASH_REMATCH[2]}"
        yyyy="${BASH_REMATCH[3]}"
        hh="${BASH_REMATCH[4]}"
        min="${BASH_REMATCH[5]}"
        ss="${BASH_REMATCH[6]}"

        # –§–æ—Ä–º—É—î–º–æ –Ω–æ–≤–µ —ñ–º'—è —Ñ–∞–π–ª—É —É —Ñ–æ—Ä–º–∞—Ç—ñ –†–†–†–†-–ú–ú-–î–î_–ì–ì-–•–•-–°–°.md
        new_name="${yyyy}-${mm}-${dd}_${hh}-${min}-${ss}.md"

        # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É
        if [ -f "$new_name" ]; then
            echo "‚ö†Ô∏è  –ü—Ä–æ–ø—É—Å–∫: –§–∞–π–ª '$new_name' –≤–∂–µ —ñ—Å–Ω—É—î. –ù–µ –ø–µ—Ä–µ–π–º–µ–Ω–æ–≤—É—é '$old_name'."
            continue
        fi

        # –í–∏–∫–æ–Ω—É—î–º–æ –ø–µ—Ä–µ–π–º–µ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–∏–≤–æ–¥–∏–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        echo "‚úÖ –ü–µ—Ä–µ–π–º–µ–Ω–æ–≤—É—é: '$old_name' -> '$new_name'"
        mv -- "$old_name" "$new_name"
        ((renamed_count++))
    fi
done

echo "-----------------------------------------"
if [ "$renamed_count" -gt 0 ]; then
    echo "üéâ –ó–∞–≤–µ—Ä—à–µ–Ω–æ! –ü–µ—Ä–µ–π–º–µ–Ω–æ–≤–∞–Ω–æ —Ñ–∞–π–ª—ñ–≤: $renamed_count."
else
    echo "üëç –£—Å—ñ —Ñ–∞–π–ª–∏ –≤–∂–µ –º–∞—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç. –ù—ñ—á–æ–≥–æ –Ω–µ –∑–º—ñ–Ω–µ–Ω–æ."
fi
